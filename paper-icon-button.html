<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE
The complete set of authors may be found at http://polymer.github.io/AUTHORS
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS
-->

<!--
/**
 * @group Quantum Paper Elements
 *
 * `paper-icon-button` is a button with an image placed at the center.
 *
 * Example:
 *
 *     <paper-icon-button src="star.png"></paper-icon-button>
 *
 * `paper-icon-button` includes a default icon set.  Use `icon` to specify 
 * which icon from the icon set to use.
 *
 * Example:
 *
 *     <paper-icon-button icon="menu"></paper-icon-button>
 *
 * See <a href="core-iconset.html">core-iconset</a> for more information about 
 * how to use a custom icon set.
 *
 * @element paper-icon-button
 * @extends paper-focusable
 * @homepage github.io
 */
-->

<link href="../core-icon/core-icon.html" rel="import">
<link href="../paper-focusable/paper-focusable.html" rel="import">
<link href="../paper-ink/paper-ink.html" rel="import">

<polymer-element name="paper-icon-button" extends="paper-focusable" attributes="src icon inkColor fillInk" on-tap="{{tapAction}}" on-down="{{downAction}}" on-up="{{upAction}}">

  <template>
  
    <link rel="stylesheet" href="pulse-ink.css">
    <link rel="stylesheet" href="paper-icon-button.css">
    
    <paper-ink id="ink" color="{{inkColor}}"></paper-ink>
    <core-icon src="{{src}}" icon="{{icon}}"><content></content></core-icon>
    
  </template>
  
  <script>
  
    Polymer('paper-icon-button', {

      publish: {

        /**
         * The color of the ink that spreads when the button is tapped.
         *
         * @attribute inkColor
         * @type string
         */
         inkColor: { value: '#d3d3d3', reflect: true },

         /**
          * If true, the ink expands to completely fill the bounds of the
          * button. Otherwise, the ink expands to a circle with a diameter
          * equal to the width of the button.
          */
         fillInk: { value: false, reflect: false }

      },
      
      /**
       * The URL of an image for the icon.  Should not use `icon` property
       * if you are using this property.
       *
       * @attribute src
       * @type string
       * @default ''
       */
      src: '',
      
      /**
       * Specifies the icon name or index in the set of icons available in
       * the icon set.  Should not use `src` property if you are using this
       * property.
       *
       * @attribute icon
       * @type string
       * @default ''
       */
      icon: '',

      registerCallback: function(element) {
        this.inkStyle = element.templateContent().firstElementChild;
      },

      focusedChanged: function() {
        this.super();

        if (!this._installedInkStyle) {
          this.installInkStyle();
        }

        if (this.focused) {
          this.$.ink.spill();
        } else {
          this.resetInk();
        }
      },

      activeChanged: function() {
        this.super();

        if (!this._measuredInk) {
          this.fillInkChanged();
        }

        if (this.active) {
          this.$.ink.spill();
        } else {
          this.$.ink.evaporate();
        }
      },

      fillInkChanged: function() {
        this._measuredInk = true;

        if (this.fillInk) {
          var rect = this.getBoundingClientRect();
          var inkDiameter = Math.sqrt(2 * rect.width * rect.width);
          var offset = (rect.width - inkDiameter) / 2
          this.$.ink.style.height = inkDiameter + 'px';
          this.$.ink.style.width = inkDiameter + 'px';
          this.$.ink.style.left = offset + 'px';
          this.$.ink.style.top = offset + 'px';
        } else {
          this.$.ink.style.height = null;
          this.$.ink.style.width = null;
          this.$.ink.style.left = null;
          this.$.ink.style.top = null;
        }
      },

      installInkStyle: function() {
        this.installScopeStyle(this.inkStyle, 'paper-icon-button-ink-animation', this.$.ink.shadowRoot);
        this._installedInkStyle = true;
      },

      waitForSpillCompleted: function(callback) {
        this.async(callback, null, (this.$.ink.spillCompleted ? 0 : this.duration));
      },

      resetInk: function() {
        this.$.ink.reset();
      },

      insideButton: function(x, y) {
        var rect = this.getBoundingClientRect();
        return (rect.left <= x) && (x <= rect.right) && (rect.top <= y) && (y <= rect.bottom);
      },

      tapAction: function() {
        if (this.disabled) {
          return;
        }

        if (!this.isToggle) {
          this.waitForSpillCompleted(function() {
            this.active = false;
          });
        }
      }

    });
    
  </script>
  
</polymer-element>
